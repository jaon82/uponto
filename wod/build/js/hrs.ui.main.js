hrs=window.hrs||{},hrs.ui=window.hrs.ui||{},utils=new Utils,hrs.ui.main=function(a,b,c){function d(){var b=a("#month-name").text();b=a.trim(b),b=b.replace(" ","").replace(" ","");var c=parseInt(b.length);return b=b.substring(c-4,c)}function e(b){a("#"+b+" .begin-day input").val(""),a("#"+b+" .start-lunch input").val(""),a("#"+b+" .end-lunch input").val(""),a("#"+b+" .end-day input").val(""),a("#"+b+" .end-day input").attr("placeholder",""),a("#"+b+" .vpn-cell input").val(""),a("#"+b+" .all-worked").text(""),a("#"+b+" .lunch").text(""),a("#"+b+" .excedente").text("")}function f(){var d=c.loadSettings();if(1==d.permAhgora){var e=d.matricula,f=d.senha,g=d.empresa;if(0==g.length&&(g=null),0==f.length&&(f=null),0==e.length&&(e=null),null==e||null==f||null==g){var h="Informe sua Matrícula, Senha e Empresa nas Configurações antes de realizar a importação.";a("#msg-lightbox-content").html(h),v("#perform-update"),t("#msg-lightbox")}else G=new Ahgora(e,f,g,b,c,t,v,p,j)}else G=null}function g(){E=new hrs.ui.month(D.getMonth(),D.getFullYear());var a=D.getMonth(),b=D.getFullYear();G.import(a,b,null)}function h(){F=new DesktopNotifications}function i(){var a=new Date,b=a.getFullYear(),c=(a.getDay(),a.getDate()),d=a.getMonth(),e=new Date(b,d,c),f=E.getRowInfo(e),g=(f.entrada,a.getHours(),a.getMinutes()),h=a.getSeconds();59==parseInt(g)&&0==parseInt(h)&&G.import(d,b,c);setTimeout(function(){i()},500)}function j(){i();var b=hrs.helpers.dateTime,c=new Date,d=c.getMonth(),e=c.getFullYear(),f=c.getDate(),g=new Date(e,d,f),h=E.getRowInfo(g),j=h.expectedExit,k=j.substring(0,2),o=j.substring(3,5),p=new Date(e,d,f,k,o,0,0),q=(h.almoco,h.ida_almoco),r=h.volta_almoco,s=h.volta_almoco_estimada,t=h.volta_almoco_estimada_time,b=hrs.helpers.dateTime;a("#saidaAlmocoEstimada").html("12:00");var u;u=q.length>0?q:"-",a("#saidaAlmocoReal").html(u);var v;if(v=s.length>0?s:"-",a("#retornoAlmoco").html(v),a("#retornoAlmocoReal").html("-"),(null==r||"undefined"==r||""==r)&&q.length>0){{new Date(t.getYear(),t.getMonth(),t.getDay(),t.getHours(),t.getMinutes(),0,0)}a("#retornoAlmoco").html(v),a("#retornoAlmocoTimer").css("color","green"),a("#retornoAlmocoReal").html("-");var w=b.getTimeDiff(t,c),x=w.getTime();l(t,x)}else a("#retornoAlmocoTimer").css("color","black"),a("#retornoAlmocoReal").html(r),a("#retornoAlmocoTimer").html("-"),a("#retornoAlmoco").html("-");var y=h.saida,z=h.entrada;if((null==y||"undefined"==y||""==y)&&z.length>0){a("#proxSaidaExtimada").html(j),a("#proxSaidaTimer").css("color","red");var A=b.getTimeDiff(p,c),B=A.getTime();n(p,B)}else a("#proxSaidaTimer").css("color","black"),a("#saidaTimeLabel").html("Tempo at� sa�da: "),a("#proxSaidaExtimada").html("-"),a("#proxSaidaTimer").html("-");var C=(h.expectedExit,3),D=0,F=new Date(2014,11,13,C,D,0,0);if(document.getElementById("alarm-sound-wod").play(),document.getElementById("alarm-sound-wod").volume=.3,z.length>0){a("#proxSaidaTimer2").css("color","red");var A=b.getTimeDiff(F,c),B=A.getTime();m(F,B)}else a("#proxSaidaTimer2").css("color","black"),a("#proxSaidaTimer2").html("-"),document.getElementById("alarm-sound-wod").pause()}function k(a,b){var c=utils.checkbrowser();if("Chrome"==c.name||"Firefox"==c.name){var d="Controle de Banco de Horas",e={body:a,icon:"res/icon.png"};F.create(d,e,null,b)}else alert("Notificações não implementadas para esta versão do seu browser.")}function l(b,c){var d=new Date,e=hrs.helpers.dateTime;if(c>0){a("#retornoAlmocoTimer").css("color","green"),a("#retornoAlmocoTimerLabel").html("Tempo até retorno: ");var f=e.getTimeDiff(b,d);c=f.getTime()}else{a("#retornoAlmocoTimer").css("color","red"),a("#retornoAlmocoTimerLabel").html("Tempo de atraso: ");var f=e.getTimeDiff(d,b)}var g=f.getTime(),h=new Date(g),i=f.getHours(),j=h.getMinutes(),m=h.getSeconds();if(c>0&&0==parseInt(i))switch(j){case 5:if(59==m){var n="Faltam "+j+" minuto(s) para encerrar seu horário de almoço! Fique atento.";k(n,"five")}break;case 0:if(59==m){var n="Falta menos de um minuto minuto(s) para encerrar seu horário de almoço!";k(n,"default")}else if(0==m){var n="Seu horário de almoço já encerrou! Você deve bater seu ponto imediatamente!!!";k(n,"default")}}else if(0>c&&0==parseInt(i)&&j>0&&0==m){var n="Seu horário de almoço já encerrou! Você deve bater seu ponto imediatamente!!!";k(n,"default")}i=o(i),j=o(j),m=o(m);var p=i+":"+j+":"+m;a("#retornoAlmocoTimer").html(p);setTimeout(function(){l(b,c)},500)}function m(b,c){var d=new Date,e=hrs.helpers.dateTime;if(c>0){a("#proxSaidaTimer2").css("color","red");var f=e.getTimeDiff(b,d);c=f.getTime()}else{a("#proxSaidaTimer2").css("color","green");var f=e.getTimeDiff(d,b)}var g=f.getTime(),h=new Date(g),i=f.getHours(),j=h.getMinutes(),k=h.getSeconds();i=o(i),j=o(j),k=o(k);var l=i+":"+j+":"+k;a("#proxSaidaTimer2").html(l);setTimeout(function(){m(b,c)},500)}function n(b,c){var d=new Date,e=hrs.helpers.dateTime;if(c>0){a("#saidaTimeLabel").html("Tempo até saída: "),a("#proxSaidaTimer").css("color","red");var f=e.getTimeDiff(b,d);c=f.getTime()}else{a("#saidaTimeLabel").html("Hora extra: "),a("#proxSaidaTimer").css("color","green");var f=e.getTimeDiff(d,b)}var g=f.getTime(),h=new Date(g),i=f.getHours(),j=h.getMinutes(),l=h.getSeconds();if(c>0&&0==parseInt(i))switch(j){case 30:if(59==l){var m="Faltam "+j+" minuto(s) para sua saída. Fique atento!";k(m,"default")}break;case 20:if(59==l){var m="Faltam "+j+" minuto(s) para sua saída. Fique atento!";k(m,"default")}break;case 10:if(59==l){var m="Faltam "+j+" minuto(s) para sua saída. Fique atento!";k(m,"ten")}break;case 5:if(59==l)if(5==j){var m="Faltam "+j+" minuto(s) para sua saída. Fique atento!";k(m,"five")}else{var m="Faltam "+j+" minuto(s) para sua saída. Fique atento!";k(m,"chimes")}break;case 0:if(59==l){var m="Falta menos de 1 minuto para sua saída. Fique atento!";k(m,"default")}}i=o(i),j=o(j),l=o(l);var p=i+":"+j+":"+l;a("#proxSaidaTimer").html(p);setTimeout(function(){n(b,c)},500)}function o(a){return 10>a&&(a="0"+a),a}function p(){E=new hrs.ui.month(D.getMonth(),D.getFullYear()),E.setDao(c),E.setUpdatedRowCallback(q),E.print(H),a("#main-table tr").each(function(){var b=a(this);r(b.find(".total, .excedente"),b.find(".excedente").html())}),q()}function q(d,e){var f=c.calculateTotals(D.getMonth(),D.getFullYear());a("#extra").html(f.extra.toString()),a("#extra-month").html(f.extraMonth.toString()),a("#month-name").html(b.dateTime.formatDate(D,"#MM / #yyyy"));var g=b.dateTime.formatDate(D,"#MM / #yyyy"),h="Importar "+g+" (Sistema Ahgora)";a("#importMonth").attr("value",h),r(a("#extra"),f.extra.toString()),r(a("#extra-month"),f.extraMonth.toString()),void 0!=e&&r(d.find(".total, .excedente"),e.excedente),a("#entrance-avg").html(b.dateTime.formatDate(f.avgEntrance,"#hh#m")),a("#exit-avg").html(b.dateTime.formatDate(f.avgExit,"#hh#m")),f.totalExtraDays>=0?(a("#positive-days").show().find("#days-off").html(f.totalExtraDays),a("#negative-days").hide()):(a("#negative-days").show().find("#days-to-pay").html(f.totalExtraDays),a("#positive-days").hide()),a("#ausent-days").html(f.ausentDays)}function r(a,b){var c="string"==typeof b?b.indexOf("-")>-1:0>b,d=c?"addClass":"removeClass";a[d]("negative-hours")}function s(){var b=c.loadSettings();a("#total-work").val(b.totalWork).change(w),a("#lunch-time").val(b.lunchTime).change(w),a("#control-since").val(b.controlSince).change(w),a("#initial-balance").val(b.initialBalance).change(w),1==b.permAhgora?(a("#permAhgora").attr("checked","checked"),a("#showAhgora").fadeIn(),a(".btImportMonth").show(),a(".upDayOn").show(),a(".upDayOff").hide()):(a("#permAhgora").removeAttr("checked"),a("#showAhgora").fadeOut(),a(".btImportMonth").hide(),a(".upDayOn").hide(),a(".upDayOff").show()),a("#permAhgora").change(w),1==b.permNotif?(a("#permNotif").attr("checked","checked"),a("#showNotif").fadeIn()):(a("#permNotif").removeAttr("checked"),a("#showNotif").fadeOut()),a("#permNotif").change(w),a("#matricula").val(b.matricula).change(w),a("#senha").val(b.senha).change(w),a("#empresa").val(b.empresa).change(w);for(var d=a("div.utilDays input:checkbox"),e=0;e<b.utilDays.length;e++)d.filter("[value="+b.utilDays[e]+"]").attr("checked","checked");d.change(w)}function t(b){var c=a(b);c.fadeIn().css("z-index",I++);var d=(a(window).width()-c.width())/2,e=(a(window).height()-c.height())/2;c.css({top:e+"px",left:d+"px"})}function u(){a(".open-lightbox").click(function(b){b.preventDefault(),t(a(this).attr("href"))}),a(".lightbox .close").click(function(){a(this).closest(".lightbox").fadeOut().css("z-index","auto")})}function v(b){a(b).closest(".lightbox").fadeOut().css("z-index","auto")}function w(b,d){var e=[];a("input.utilDay:checked").each(function(){e.push(this.value)});var f=a("#permAhgora").is(":checked");f=f?1:0;var g=a("#permNotif").is(":checked");g=g?1:0;var h=a("#control-since").val();c.saveSettings({totalWork:a("#total-work").val(),lunchTime:a("#lunch-time").val(),controlSince:h,initialBalance:a("#initial-balance").val(),permAhgora:f,permNotif:g,matricula:a("#matricula").val(),senha:a("#senha").val(),empresa:a("#empresa").val(),holidays:d||hrs.ui.holidays.getHolidays(),utilDays:e}),p()}function x(){a("#prev-month").click(function(){D.setMonth(D.getMonth()-1),p()}),a("#next-month").click(function(){D.setMonth(D.getMonth()+1),p()})}function y(a){var b=new FileReader;b.onload=function(a){var b=a.target.result;c.importData(b),p()},b.readAsText(a,"UTF-8"),setTimeout(function(){location.reload()},500)}function z(){a("#link-export").click(function(){a("#output-export").val(c.exportData())[0].select()}),a("#output-export").click(function(){this.select()}),a("#import-data").click(function(){a("#inputfile-import-data").click()}),a("#proced-import").click(function(){y(a("#confirm-import")[0].file)}),a("#inputfile-import-data").change(function(b){var c=b.target.files;0!=c.length&&(a("#confirm-import")[0].file=c[0],a("#inputfile-import-data").val(""),t("#confirm-import"))})}function A(){hrs.ui.holidays.init({$elem:a("#holidays-list"),holidays:c.getHolidays(),callback:function(a){w(null,a)}})}function B(){a("a.export-pdf").click(function(a){a.preventDefault(),window.print()})}var C={},D=null,E=null,F=null,G=null,H=null,I=3;return C.init=function(b){H=b,D=new Date,p(),s(),u(),x(),z(),A(),h(),B(),j(),i(),f(),a("#importMonth").click(function(){g()}),a("#about-button").click(function(){t("#about-lightbox")}),a("#current-month").click(function(){var a=new Date;D.setMonth(a.getMonth()),p()}),a("#revisarPermissoes").click(function(){F.checkPermissionDirect()}),a("#closeSettings").click(function(){window.location.reload()});var c=!1;a("#stop-wod").click(function(){c?(document.getElementById("alarm-sound-wod").play(),a("#alarm-sound-wod").val("Pausar Música"),c=!1):(document.getElementById("alarm-sound-wod").pause(),a("#alarm-sound-wod").val("Tocar M�sica"),c=!0)}),a("#permAhgora").click(function(){var b=a(this).is(":checked");b?a("#showAhgora").fadeIn():a("#showAhgora").fadeOut(),f()}),a("#permNotif").click(function(){var b=a(this).is(":checked");b?a("#showNotif").fadeIn():a("#showNotif").fadeOut()})},window.updateDay=function(a){var b=D.getFullYear(),c=a+"/"+b,d=c.substr(0,2),e=c.substr(3,2),f=a.substr(3,2);e=parseInt(f),e=parseInt(d)<11?parseInt(f)-1:parseInt(f),G.import(e,b,d)},window.removeDay=function(a){var b=d(),c=a.substr(0,2),f=a.substr(3,2);f=parseInt(f)-1,parseInt(f)<10&&(f="0"+f);{var g=new Date(b,f,c),h=g.getTime();localStorage.getItem(h)}confirm("Deseja realmente excluir este dia?")&&(localStorage.removeItem(h),e(h))},window.toogleAusent=function(b){var c=d(),e=b.substr(0,2),f=b.substr(3,2);f=parseInt(f)-1,parseInt(f)<10&&(f="0"+f);var g=new Date(c,f,e),h=g.getTime(),i=(localStorage.getItem(h),a("#"+h+" .ausentLine input")),j=a("#"+h+" .ausentImg"),k=a("#"+h+" .ausentLine input").attr("checked");k&&k.length>0?(i.removeAttr("checked"),i.val("N"),j.attr("src","res/img/ausent.png"),j.attr("title","Presente no local de trabalho. Clique para sinalizar ausência neste dia.")):(i.attr("checked","checked"),i.val("S"),j.attr("src","res/img/user2.png"),j.attr("title","Ausente no local de trabalho. Clique para sinalizar presença neste dia.")),E.changeEvent2(h)},C}(jQuery,hrs.helpers,hrs.dao),$(function(){hrs.ui.main.init($("#main-table")),$("#control-since").datepicker({dateFormat:"dd/mm/yy"})});