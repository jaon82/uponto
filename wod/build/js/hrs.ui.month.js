hrs=window.hrs||{},hrs.ui=window.hrs.ui||{},hrs.ui.month=function(a,b){function c(a){return""!=a&&void 0!=a?new Date(parseInt(a)):""}function d(a){var b=n.getDateInfo(a),c=b.obs;""==c&&b.holiday&&""!=b.holiday.obs&&(c=b.holiday.obs);var d={data:p.formatDate(a,"#d/#M"),diaSemana:p.weekDay(a.getDay()),entrada:p.formatDate(b.entrada,"#h:#m"),ida_almoco:p.formatDate(b.ida_almoco,"#h:#m"),volta_almoco:p.formatDate(b.volta_almoco,"#h:#m"),saida:p.formatDate(b.saida,"#h:#m"),vpn:p.formatDate(b.vpn,"#h:#m"),total:f(b.total),almoco:f(b.almoco),excedente:f(b.extra),checked:b.ausent?'checked="checked"':"",holiday:null!=b.holiday,obs:c,cssObsPreenchida:""!=c?" filled":""};if(d.entrada){var g=e(b.entrada.getTime(),b.volta_almoco-b.ida_almoco);d.expectedExit=p.formatDate(g,"#h:#m")}else d.expectedExit="";return d}function e(a,b){var c=n.loadSettings();(!b||0>b)&&(b=60*c.lunchTime*60*1e3);var d=new hrs.timeStamp(a);d.addTimeStamp(b),d.addHours(c.totalWork);var e=new Date(d.getTime());return e}function f(a){return void 0==a?"":a.toString()}function g(a,b,c){var e=d(a),f=a.getDay()%2!=0?"even":"";p.isWeekend(a)&&(f+=" weekend"),e.holiday&&(f+=" holiday"),""!=f&&(f='class="'+f+'"');var g='<tr id="'+a.getTime()+'"'+f+">"+c.html()+"</tr>";for(var l in e)g=g.split("{"+l+"}").join(e[l]);var m=$(g);m.find("input,textarea, .obs").change(h).blur(i).on("contextmenu",j),m.find(".view-full-obs").click(k),b.append(m)}function h(a){var b=$(a.target).closest("tr"),c=new Date(parseInt(b.attr("id"))),e=b.find(".ausent")[0].checked,f={entrada:p.parseDateTime(b.find(".start").val(),c),ida_almoco:p.parseDateTime(b.find(".lunch-start").val(),c),volta_almoco:p.parseDateTime(b.find(".lunch-end").val(),c),saida:p.parseDateTime(b.find(".end").val(),c),vpn:p.parseDateTime(b.find(".vpn").val(),c),obs:b.find(".obs").text(),ausent:e};n.storeDate(c,f),e?b.find("input[type!=checkbox]").attr("disabled",!0):b.find("input[type!=checkbox]").removeAttr("disabled");var g=d(c);b.find(".total").html(g.total),b.find(".excedente").html(g.excedente),b.find(".almoco").html(g.almoco),""!=f.entrada&&b.find(".end").attr("placeholder",g.expectedExit),null!=q&&q(b,g)}function i(a){var b=$(a.target),c=b.val();if(""!=c){-1==c.indexOf(":")&&(c+=":0"),c=c.replace(/[^\d:]/g,"");var d=c.split(":");d[0]=o.number.addZeros(d[0],2),d[1]=o.number.addZeros(d[1],2),b.val(d.join(":"))}}function j(a){a.preventDefault();var b=$(this),c=b.offset();r||(r=$("#input-context-menu")),r.css({top:c.top+10,left:c.left+10}).fadeIn(100),$(document).mousedown(function(){r.fadeOut(100),$(document).off("click")})}function k(a){a.preventDefault();var b=$(this).offset(),c=$("#box-obs");c.css({top:b.top+"px",left:b.left+"px"}).fadeIn().find("textarea").val(this.title),c[0].refInput=$(this).closest(".obs_cell").find(".obs")}function l(a){a.preventDefault(),$boxObs=$("#box-obs").fadeOut();var b=$boxObs.find("textarea").val();$boxObs[0].refInput.html(b).trigger("change").parents(".obs_cell").find(".view-full-obs")[""==b?"removeClass":"addClass"]("filled").attr("title",b)}var m={},n=null,o=hrs.helpers,p=hrs.helpers.dateTime,q=null,r=null;return m.getRowInfo=function(a){var b=n.getDateInfo(a),d=b.obs;if(""==d&&b.holiday&&""!=b.holiday.obs&&(d=b.holiday.obs),b.ida_almoco&&""!=b.ida_almoco&&0!=b.ida_almoco&&null!=b.ida_almoco&&"undefined"!=b.ida_almoco){settings=n.loadSettings();var g=b.ida_almoco.getTime()/1e3,h=60*settings.lunchTime*60,i=1e3*(parseInt(g)+parseInt(h)),j=c(i)}else var j=new Date,i=0;var k={data:p.formatDate(a,"#d/#M"),diaSemana:p.weekDay(a.getDay()),entrada:p.formatDate(b.entrada,"#h:#m"),ida_almoco:p.formatDate(b.ida_almoco,"#h:#m"),volta_almoco:p.formatDate(b.volta_almoco,"#h:#m"),volta_almoco_estimada:p.formatDate(j,"#h:#m"),volta_almoco_estimada_time:c(i),saida:p.formatDate(b.saida,"#h:#m"),vpn:p.formatDate(b.vpn,"#h:#m"),total:f(b.total),almoco:f(b.almoco),excedente:f(b.extra),checked:b.ausent?'checked="checked"':"",holiday:null!=b.holiday,obs:d,cssObsPreenchida:""!=d?" filled":""};if(k.entrada){var l=e(b.entrada.getTime(),b.volta_almoco-b.ida_almoco);k.expectedExit=p.formatDate(l,"#h:#m")}else k.expectedExit="";return k},m.changeEvent2=function(a){alert(a);var a=new Date(parseInt(a)),b=$row.find(".ausent")[0].checked,c={entrada:p.parseDateTime($row.find(".start").val(),a),ida_almoco:p.parseDateTime($row.find(".lunch-start").val(),a),volta_almoco:p.parseDateTime($row.find(".lunch-end").val(),a),saida:p.parseDateTime($row.find(".end").val(),a),vpn:p.parseDateTime($row.find(".vpn").val(),a),obs:$row.find(".obs").text(),ausent:b};n.storeDate(a,c),b?$row.find("input[type!=checkbox]").attr("disabled",!0):$row.find("input[type!=checkbox]").removeAttr("disabled");var e=d(a);$row.find(".total").html(e.total),$row.find(".excedente").html(e.excedente),$row.find(".almoco").html(e.almoco),""!=c.entrada&&$row.find(".end").attr("placeholder",e.expectedExit),null!=q&&q($row,e)},m.setDao=function(a){n=a},m.setUpdatedRowCallback=function(a){q=a},m.print=function(c){var d=new Date(b,a,1),e=$("#row-template",c);for(c.find("tr:not(.fixed-row)").remove();d.getMonth()==a;){var f=d.getDate();g(d,c,e),d.setDate(f+1),d.getDate()==f&&d.setDate(d.getDate()+1)}$("#box-obs .close-obs").click(l)},m},hrs.ui.month.static=function(){function a(){b()}function b(){$(document).on("mousedown","#insert-current-time",function(){var a=new Date;$(document.activeElement).val(a.getHours()+":"+a.getMinutes()).trigger("change")})}a()}();